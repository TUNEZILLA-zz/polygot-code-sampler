name: Conventional Commits Check
on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  conventional-commits:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Check PR title with Conventional Commits
      uses: amannn/action-semantic-pull-request@v5
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        # Configuration for Conventional Commits
        types: |
          feat
          fix
          chore
          docs
          style
          refactor
          perf
          test
          build
          ci
        requireScope: false

    - name: Generate changelog preview
      run: |
        echo "ðŸ“ Changelog Preview:"
        echo "===================="

        # Get commits since last tag
        last_tag=$(git describe --tags --abbrev=0 HEAD~1 2>/dev/null || echo "")
        if [[ -n "$last_tag" ]]; then
          echo "Changes since $last_tag:"
          git log --pretty=format:"- %s (%h)" --since="$last_tag" | head -10
        else
          echo "All commits:"
          git log --pretty=format:"- %s (%h)" -10
        fi
