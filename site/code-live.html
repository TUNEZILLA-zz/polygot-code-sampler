<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéõÔ∏è Code Live - The Ableton Live of Code</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
            color: #e0e0e0; min-height: 100vh; overflow-x: auto;
        }
        .live-container { display: flex; flex-direction: column; min-height: 100vh; padding: 12px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 2rem; background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffa500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 6px; }
        .header p { color: #a0a0a0; font-size: 0.9rem; }
        .input-section { background: linear-gradient(145deg, #2a2a3e, #1e1e2e); border-radius: 10px; padding: 12px; margin-bottom: 15px; border: 1px solid #4a4a5e; }
        .input-title { font-size: 0.9rem; margin-bottom: 8px; color: #4ecdc4; }
        .python-input { width: 100%; background: #0a0a0a; border: 1px solid #4a4a5e; border-radius: 5px; padding: 10px; font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace; font-size: 0.8rem; color: #e0e0e0; resize: vertical; min-height: 50px; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .mixer-board { background: linear-gradient(145deg, #2a2a3e, #1e1e2e); border-radius: 12px; padding: 15px; border: 1px solid #4a4a5e; }
        .section-title { font-size: 1rem; margin-bottom: 12px; color: #4ecdc4; text-align: center; }
        .channels-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 12px; }
        .channel { background: linear-gradient(145deg, #1e1e2e, #2a2a3e); border-radius: 8px; padding: 10px; border: 1px solid #3a3a4e; text-align: center; }
        .channel-name { font-size: 0.7rem; color: #4ecdc4; margin-bottom: 6px; font-weight: 600; }
        .fader-container { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
        .fader { flex: 1; height: 60px; background: linear-gradient(to top, #1a1a2e, #2a2a3e); border-radius: 3px; position: relative; border: 1px solid #4a4a5e; }
        .fader-track { position: absolute; left: 50%; top: 0; width: 2px; height: 100%; background: linear-gradient(to top, #ff6b6b, #4ecdc4); border-radius: 1px; transform: translateX(-50%); }
        .fader-knob { position: absolute; left: 50%; width: 10px; height: 10px; background: linear-gradient(145deg, #4ecdc4, #45b7d1); border-radius: 50%; transform: translateX(-50%); cursor: pointer; box-shadow: 0 2px 4px rgba(78, 205, 196, 0.4); transition: all 0.2s ease; }
        .fader-knob:hover { transform: translateX(-50%) scale(1.1); box-shadow: 0 3px 6px rgba(78, 205, 196, 0.6); }
        .fader-value { font-size: 0.6rem; color: #4ecdc4; font-weight: 600; min-width: 20px; text-align: center; }
        .channel-controls { display: flex; gap: 4px; justify-content: center; margin-bottom: 6px; }
        .control-button { background: #1a1a2e; border: 1px solid #4a4a5e; border-radius: 3px; padding: 2px 4px; color: #a0a0a0; cursor: pointer; transition: all 0.3s ease; font-size: 0.5rem; }
        .control-button:hover { border-color: #4ecdc4; color: #4ecdc4; }
        .control-button.active { background: linear-gradient(145deg, #4ecdc4, #45b7d1); border-color: #4ecdc4; color: #1a1a2e; }
        .pan-knob { width: 24px; height: 24px; background: linear-gradient(145deg, #1a1a2e, #2a2a3e); border: 1px solid #4a4a5e; border-radius: 50%; position: relative; cursor: pointer; margin: 0 auto; }
        .pan-indicator { position: absolute; top: 2px; left: 50%; width: 1px; height: 8px; background: #4ecdc4; border-radius: 1px; transform: translateX(-50%); transform-origin: bottom center; }
        .meter { height: 3px; background: #3a3a4e; border-radius: 2px; margin-top: 3px; position: relative; overflow: hidden; }
        .meter-fill { height: 100%; background: linear-gradient(90deg, #4ecdc4, #ff6b6b); border-radius: 2px; transition: width 0.3s ease; }
        .macro-rack { background: linear-gradient(145deg, #1e1e2e, #2a2a3e); border-radius: 10px; padding: 12px; border: 1px solid #3a3a4e; margin-bottom: 12px; }
        .macro-knobs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .macro-knob { text-align: center; }
        .macro-label { font-size: 0.6rem; color: #4ecdc4; margin-bottom: 4px; font-weight: 600; }
        .macro-control { width: 40px; height: 40px; background: linear-gradient(145deg, #1a1a2e, #2a2a3e); border: 2px solid #4a4a5e; border-radius: 50%; position: relative; cursor: pointer; margin: 0 auto; transition: all 0.3s ease; }
        .macro-control:hover { border-color: #4ecdc4; box-shadow: 0 3px 8px rgba(78, 205, 196, 0.3); }
        .macro-control.pulsing { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.7); } 50% { box-shadow: 0 0 0 8px rgba(78, 205, 196, 0); } }
        .macro-indicator { position: absolute; top: 3px; left: 50%; width: 1px; height: 12px; background: #4ecdc4; border-radius: 1px; transform: translateX(-50%); transform-origin: bottom center; }
        .macro-value { font-size: 0.5rem; color: #a0a0a0; margin-top: 3px; }
        .clip-launcher { background: linear-gradient(145deg, #1e1e2e, #2a2a3e); border-radius: 10px; padding: 12px; border: 1px solid #3a3a4e; }
        .clip-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 10px; }
        .clip { background: #0a0a0a; border: 1px solid #4a4a5e; border-radius: 4px; padding: 6px; cursor: pointer; transition: all 0.3s ease; text-align: center; min-height: 40px; display: flex; flex-direction: column; justify-content: center; }
        .clip:hover { border-color: #4ecdc4; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(78, 205, 196, 0.3); }
        .clip.playing { border-color: #ff6b6b; background: linear-gradient(145deg, #2e1e1e, #3e2a2a); box-shadow: 0 2px 6px rgba(255, 107, 107, 0.4); }
        .clip-name { font-size: 0.6rem; color: #4ecdc4; font-weight: 600; margin-bottom: 2px; }
        .clip-desc { font-size: 0.5rem; color: #a0a0a0; }
        .timeline-section { background: linear-gradient(145deg, #2a2a3e, #1e1e2e); border-radius: 12px; padding: 15px; border: 1px solid #4a4a5e; }
        .timeline-controls { display: flex; gap: 10px; margin-bottom: 12px; align-items: center; flex-wrap: wrap; }
        .play-button { background: linear-gradient(145deg, #4ecdc4, #45b7d1); border: none; border-radius: 5px; padding: 6px 12px; color: #1a1a2e; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 0.7rem; }
        .play-button:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(78, 205, 196, 0.4); }
        .play-button.playing { background: linear-gradient(145deg, #ff6b6b, #ff8e8e); }
        .timeline-slider { flex: 1; height: 3px; background: #3a3a4e; border-radius: 2px; outline: none; cursor: pointer; }
        .timeline-slider::-webkit-slider-thumb { appearance: none; width: 10px; height: 10px; background: linear-gradient(145deg, #4ecdc4, #45b7d1); border-radius: 50%; cursor: pointer; box-shadow: 0 2px 4px rgba(78, 205, 196, 0.4); }
        .timeline-track { background: #1a1a2e; border: 1px solid #4a4a5e; border-radius: 5px; padding: 10px; margin-bottom: 12px; min-height: 80px; position: relative; }
        .keyframe { position: absolute; width: 12px; height: 12px; background: linear-gradient(145deg, #4ecdc4, #45b7d1); border-radius: 50%; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(78, 205, 196, 0.4); }
        .keyframe:hover { transform: scale(1.1); box-shadow: 0 3px 6px rgba(78, 205, 196, 0.6); }
        .keyframe.selected { background: linear-gradient(145deg, #ff6b6b, #ff8e8e); box-shadow: 0 3px 6px rgba(255, 107, 107, 0.6); }
        .creative-chaos { background: linear-gradient(145deg, #1e1e2e, #2a2a3e); border-radius: 10px; padding: 12px; border: 1px solid #3a3a4e; }
        .chaos-controls { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .chaos-button { background: #1a1a2e; border: 1px solid #4a4a5e; border-radius: 5px; padding: 4px 8px; color: #e0e0e0; cursor: pointer; transition: all 0.3s ease; font-size: 0.7rem; }
        .chaos-button:hover { border-color: #ff6b6b; color: #ff6b6b; }
        .chaos-button.active { background: linear-gradient(145deg, #ff6b6b, #ff8e8e); border-color: #ff6b6b; color: #1a1a2e; }
        .spectral-view { height: 60px; background: #0a0a0a; border: 1px solid #4a4a5e; border-radius: 4px; position: relative; overflow: hidden; }
        .spectral-bar { position: absolute; bottom: 0; width: 2px; background: linear-gradient(to top, #4ecdc4, #ff6b6b); border-radius: 1px; animation: spectralPulse 2s infinite; }
        @keyframes spectralPulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .output-section { background: linear-gradient(145deg, #1e1e2e, #2a2a3e); border-radius: 10px; padding: 12px; border: 1px solid #4a4a5e; }
        .output-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px; }
        .code-preview { background: #0a0a0a; border: 1px solid #4a4a5e; border-radius: 4px; padding: 10px; font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace; font-size: 0.6rem; color: #e0e0e0; white-space: pre-wrap; max-height: 120px; overflow-y: auto; position: relative; }
        .code-header { background: linear-gradient(145deg, #4ecdc4, #45b7d1); color: #1a1a2e; padding: 3px 6px; border-radius: 2px 2px 0 0; font-weight: 600; font-size: 0.6rem; margin: -10px -10px 6px -10px; text-align: center; }
        .loading { color: #4ecdc4; font-style: italic; text-align: center; padding: 12px; }
        .status-indicator { position: fixed; top: 12px; right: 12px; background: linear-gradient(145deg, #4ecdc4, #45b7d1); color: #1a1a2e; padding: 6px 12px; border-radius: 15px; font-weight: 600; font-size: 0.7rem; box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3); z-index: 1000; opacity: 0; transform: translateY(-12px); transition: all 0.3s ease; }
        .status-indicator.show { opacity: 1; transform: translateY(0); }
        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } .channels-grid { grid-template-columns: repeat(2, 1fr); } .timeline-controls { flex-direction: column; align-items: stretch; } }
    </style>
</head>
<body>
    <div class="status-indicator" id="statusIndicator">üéõÔ∏è Live Ready</div>
    <div class="live-container">
        <div class="header">
            <h1>üéõÔ∏è Code Live</h1>
            <p>The Ableton Live of Code - Interactive Creative Suite</p>
        </div>
        <div class="input-section">
            <div class="input-title">üêç Python Input</div>
            <textarea class="python-input" id="pythonInput" placeholder="Enter your Python comprehension here...">[x * x for x in range(0, 100) if x % 2 == 0]</textarea>
        </div>
        <div class="main-grid">
            <div class="mixer-board">
                <h2 class="section-title">üéöÔ∏è Mixer Board</h2>
                <div class="channels-grid">
                    <div class="channel">
                        <div class="channel-name">ü¶Ä Rust</div>
                        <div class="fader-container">
                            <div class="fader" data-track="rust">
                                <div class="fader-track"></div>
                                <div class="fader-knob" style="top: 30%"></div>
                            </div>
                            <div class="fader-value">30%</div>
                        </div>
                        <div class="channel-controls">
                            <button class="control-button" onclick="toggleMute('rust')">M</button>
                            <button class="control-button" onclick="toggleSolo('rust')">S</button>
                        </div>
                        <div class="pan-knob" onclick="rotatePan(event, 'rust')">
                            <div class="pan-indicator" id="rustPan"></div>
                        </div>
                        <div class="meter">
                            <div class="meter-fill" id="rustMeter" style="width: 30%"></div>
                        </div>
                    </div>
                    <div class="channel">
                        <div class="channel-name">üî¨ Julia</div>
                        <div class="fader-container">
                            <div class="fader" data-track="julia">
                                <div class="fader-track"></div>
                                <div class="fader-knob" style="top: 60%"></div>
                            </div>
                            <div class="fader-value">40%</div>
                        </div>
                        <div class="channel-controls">
                            <button class="control-button" onclick="toggleMute('rust')">M</button>
                            <button class="control-button" onclick="toggleSolo('rust')">S</button>
                        </div>
                        <div class="pan-knob" onclick="rotatePan(event, 'julia')">
                            <div class="pan-indicator" id="juliaPan"></div>
                        </div>
                        <div class="meter">
                            <div class="meter-fill" id="juliaMeter" style="width: 40%"></div>
                        </div>
                    </div>
                    <div class="channel">
                        <div class="channel-name">üóÑÔ∏è SQL</div>
                        <div class="fader-container">
                            <div class="fader" data-track="sql">
                                <div class="fader-track"></div>
                                <div class="fader-knob" style="top: 80%"></div>
                            </div>
                            <div class="fader-value">20%</div>
                        </div>
                        <div class="channel-controls">
                            <button class="control-button" onclick="toggleMute('rust')">M</button>
                            <button class="control-button" onclick="toggleSolo('rust')">S</button>
                        </div>
                        <div class="pan-knob" onclick="rotatePan(event, 'sql')">
                            <div class="pan-indicator" id="sqlPan"></div>
                        </div>
                        <div class="meter">
                            <div class="meter-fill" id="sqlMeter" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
                <div class="macro-rack">
                    <h3 class="section-title">üéõÔ∏è Macro Rack</h3>
                    <div class="macro-knobs">
                        <div class="macro-knob">
                            <div class="macro-label">Performance</div>
                            <div class="macro-control" data-knob="performance" onclick="rotateMacro(event, 'performance')">
                                <div class="macro-indicator" id="performanceIndicator"></div>
                            </div>
                            <div class="macro-value" id="performanceValue">50%</div>
                        </div>
                        <div class="macro-knob">
                            <div class="macro-label">Safety</div>
                            <div class="macro-control" data-knob="safety" onclick="rotateMacro(event, 'safety')">
                                <div class="macro-indicator" id="safetyIndicator"></div>
                            </div>
                            <div class="macro-value" id="safetyValue">50%</div>
                        </div>
                        <div class="macro-knob">
                            <div class="macro-label">Chaos</div>
                            <div class="macro-control" data-knob="chaos" onclick="rotateMacro(event, 'chaos')">
                                <div class="macro-indicator" id="chaosIndicator"></div>
                            </div>
                            <div class="macro-value" id="chaosValue">0%</div>
                        </div>
                        <div class="macro-knob">
                            <div class="macro-label">Energy</div>
                            <div class="macro-control" data-knob="energy" onclick="rotateMacro(event, 'energy')">
                                <div class="macro-indicator" id="energyIndicator"></div>
                            </div>
                            <div class="macro-value" id="energyValue">50%</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clip-launcher">
                <h2 class="section-title">üéµ Clip Launcher</h2>
                <div class="clip-grid">
                    <div class="clip" onclick="playClip(0)">
                        <div class="clip-name">Hi-Fi</div>
                        <div class="clip-desc">Sequential</div>
                    </div>
                    <div class="clip" onclick="playClip(1)">
                        <div class="clip-name">Punchy</div>
                        <div class="clip-desc">Parallel</div>
                    </div>
                    <div class="clip" onclick="playClip(2)">
                        <div class="clip-name">Lo-Fi</div>
                        <div class="clip-desc">Minimal</div>
                    </div>
                    <div class="clip" onclick="playClip(3)">
                        <div class="clip-name">SQL Club</div>
                        <div class="clip-desc">Database</div>
                    </div>
                    <div class="clip" onclick="playClip(4)">
                        <div class="clip-name">Rust Core</div>
                        <div class="clip-desc">Rust Focus</div>
                    </div>
                    <div class="clip" onclick="playClip(5)">
                        <div class="clip-name">Julia Sci</div>
                        <div class="clip-desc">Scientific</div>
                    </div>
                    <div class="clip" onclick="playClip(6)">
                        <div class="clip-name">Web Dev</div>
                        <div class="clip-desc">TypeScript</div>
                    </div>
                    <div class="clip" onclick="playClip(7)">
                        <div class="clip-name">Data Flow</div>
                        <div class="clip-desc">SQL Heavy</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="timeline-section">
            <h2 class="section-title">üé¨ Timeline & Keyframes</h2>
            <div class="timeline-controls">
                <button class="play-button" id="playButton" onclick="togglePlayback()">‚ñ∂Ô∏è Play</button>
                <input type="range" class="timeline-slider" id="timelineSlider" min="0" max="100" value="0">
                <span id="timelineTime">0s</span>
            </div>
            <div class="timeline-track" id="timelineTrack">
                <div class="keyframe" style="left: 10%; top: 50%;" data-time="10" onclick="selectKeyframe(this)"></div>
                <div class="keyframe" style="left: 50%; top: 30%;" data-time="50" onclick="selectKeyframe(this)"></div>
                <div class="keyframe" style="left: 80%; top: 70%;" data-time="80" onclick="selectKeyframe(this)"></div>
            </div>
        </div>
        <div class="creative-chaos">
            <h2 class="section-title">üé® Creative Chaos</h2>
            <div class="chaos-controls">
                <button class="chaos-button" onclick="toggleGlitch()">üåÄ Glitch</button>
                <button class="chaos-button" onclick="toggleGranular()">üéµ Granular</button>
                <button class="chaos-button" onclick="toggleSpectral()">üìä Spectral</button>
                <button class="chaos-button" onclick="toggleLFO()">üåä LFO</button>
            </div>
            <div class="spectral-view" id="spectralView">
                <!-- Spectral bars will be generated here -->
            </div>
        </div>
        <div class="output-section">
            <h2 class="section-title">üéß Live Output</h2>
            <div class="output-grid" id="outputGrid"></div>
        </div>
    </div>
    <script>
        const liveState = {
            pythonInput: '[x * x for x in range(0, 100) if x % 2 == 0]',
            tracks: { rust: 30, julia: 40, sql: 20, ts: 55 },
            muted: { rust: false, julia: false, sql: false, ts: false },
            soloed: { rust: false, julia: false, sql: false, ts: false },
            pan: { rust: 0, julia: 0, sql: 0, ts: 0 },
            macroKnobs: { performance: 50, safety: 50, chaos: 0, energy: 50 },
            currentTime: 0,
            isPlaying: false,
            playbackInterval: null,
            keyframes: [
                { time: 10, tracks: { rust: 20, julia: 30, sql: 10, ts: 40 } },
                { time: 50, tracks: { rust: 60, julia: 50, sql: 30, ts: 70 } },
                { time: 80, tracks: { rust: 80, julia: 70, sql: 50, ts: 90 } }
            ],
            chaos: { glitch: false, granular: false, spectral: false, lfo: false }
        };
        document.addEventListener('DOMContentLoaded', () => {
            initializeLive();
            generateCode();
        });
        function initializeLive() {
            document.getElementById('pythonInput').addEventListener('input', (e) => {
                liveState.pythonInput = e.target.value;
                generateCode();
            });
            document.getElementById('timelineSlider').addEventListener('input', (e) => {
                liveState.currentTime = parseInt(e.target.value);
                document.getElementById('timelineTime').textContent = `${liveState.currentTime}s`;
                updateFromTimeline();
                generateCode();
            });
            initializeFaders();
            initializeSpectral();
        }
        function initializeFaders() {
            document.querySelectorAll('.fader').forEach(fader => {
                const knob = fader.querySelector('.fader-knob');
                const valueDisplay = fader.parentElement.querySelector('.fader-value');
                const trackName = fader.dataset.track;
                let isDragging = false;
                const updateFader = (y) => {
                    const rect = fader.getBoundingClientRect();
                    const percentage = Math.max(0, Math.min(100, 100 - ((y - rect.top) / rect.height) * 100));
                    knob.style.top = percentage + '%';
                    valueDisplay.textContent = Math.round(percentage) + '%';
                    liveState.tracks[trackName] = Math.round(percentage);
                    updateMeter(trackName, percentage);
                    generateCode();
                };
                knob.addEventListener('mousedown', (e) => { isDragging = true; e.preventDefault(); });
                document.addEventListener('mousemove', (e) => { if (isDragging) updateFader(e.clientY); });
                document.addEventListener('mouseup', () => { isDragging = false; });
                fader.addEventListener('click', (e) => { updateFader(e.clientY); });
            });
        }
        function initializeSpectral() {
            const spectralView = document.getElementById('spectralView');
            for (let i = 0; i < 15; i++) {
                const bar = document.createElement('div');
                bar.className = 'spectral-bar';
                bar.style.left = `${i * 6.5}%`;
                bar.style.height = `${Math.random() * 50 + 20}%`;
                bar.style.animationDelay = `${Math.random() * 2}s`;
                spectralView.appendChild(bar);
            }
        }
        function updateMeter(track, level) {
            const meter = document.getElementById(`${track}Meter`);
            if (meter) {
                meter.style.width = `${level}%`;
            }
        }
        function toggleMute(track) {
            liveState.muted[track] = !liveState.muted[track];
            const button = document.querySelector(`[onclick="toggleMute('${track}')"]`);
            button.classList.toggle('active', liveState.muted[track]);
            generateCode();
        }
        function toggleSolo(track) {
            liveState.soloed[track] = !liveState.soloed[track];
            const button = document.querySelector(`[onclick="toggleSolo('${track}')"]`);
            button.classList.toggle('active', liveState.soloed[track]);
            generateCode();
        }
        function rotatePan(event, track) {
            const knob = event.currentTarget;
            const rect = knob.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const angle = Math.atan2(event.clientY - centerY, event.clientX - centerX);
            const degrees = (angle * 180 / Math.PI + 90 + 360) % 360;
            const panValue = Math.round((degrees / 360) * 200 - 100);
            liveState.pan[track] = panValue;
            const indicator = document.getElementById(`${track}Pan`);
            indicator.style.transform = `translateX(-50%) rotate(${degrees}deg)`;
            generateCode();
        }
        function rotateMacro(event, knobName) {
            const knob = event.currentTarget;
            const rect = knob.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const angle = Math.atan2(event.clientY - centerY, event.clientX - centerX);
            const degrees = (angle * 180 / Math.PI + 90 + 360) % 360;
            const value = Math.round(degrees / 3.6);
            liveState.macroKnobs[knobName] = value;
            const indicator = document.getElementById(`${knobName}Indicator`);
            const valueDisplay = document.getElementById(`${knobName}Value`);
            indicator.style.transform = `translateX(-50%) rotate(${degrees}deg)`;
            valueDisplay.textContent = `${value}%`;
            if (value > 80) knob.classList.add('pulsing');
            else knob.classList.remove('pulsing');
            generateCode();
        }
        function playClip(clipId) {
            const clip = document.querySelectorAll('.clip')[clipId];
            const clipTemplates = [
                { tracks: { rust: 30, julia: 20, sql: 10, ts: 25 } },
                { tracks: { rust: 90, julia: 80, sql: 30, ts: 70 } },
                { tracks: { rust: 15, julia: 10, sql: 5, ts: 20 } },
                { tracks: { rust: 20, julia: 15, sql: 95, ts: 10 } },
                { tracks: { rust: 95, julia: 20, sql: 10, ts: 30 } },
                { tracks: { rust: 20, julia: 95, sql: 10, ts: 30 } },
                { tracks: { rust: 20, julia: 30, sql: 10, ts: 95 } },
                { tracks: { rust: 20, julia: 30, sql: 95, ts: 10 } }
            ];
            if (clip.classList.contains('playing')) {
                clip.classList.remove('playing');
            } else {
                document.querySelectorAll('.clip').forEach(c => c.classList.remove('playing'));
                clip.classList.add('playing');
                const config = clipTemplates[clipId];
                if (config) {
                    liveState.tracks = { ...config.tracks };
                    updateUI();
                }
            }
            generateCode();
        }
        function togglePlayback() {
            const playButton = document.getElementById('playButton');
            if (liveState.isPlaying) {
                clearInterval(liveState.playbackInterval);
                liveState.isPlaying = false;
                playButton.textContent = '‚ñ∂Ô∏è Play';
                playButton.classList.remove('playing');
            } else {
                liveState.isPlaying = true;
                playButton.textContent = '‚è∏Ô∏è Pause';
                playButton.classList.add('playing');
                liveState.playbackInterval = setInterval(() => {
                    liveState.currentTime += 1;
                    if (liveState.currentTime > 100) liveState.currentTime = 0;
                    document.getElementById('timelineSlider').value = liveState.currentTime;
                    document.getElementById('timelineTime').textContent = `${liveState.currentTime}s`;
                    updateFromTimeline();
                    generateCode();
                }, 100);
            }
        }
        function selectKeyframe(keyframe) {
            document.querySelectorAll('.keyframe').forEach(kf => kf.classList.remove('selected'));
            keyframe.classList.add('selected');
            const time = parseInt(keyframe.dataset.time);
            const keyframeData = liveState.keyframes.find(kf => kf.time === time);
            if (keyframeData) {
                liveState.tracks = { ...keyframeData.tracks };
                updateUI();
                generateCode();
            }
        }
        function updateFromTimeline() {
            const currentTime = liveState.currentTime;
            const keyframes = liveState.keyframes;
            let beforeKeyframe = null;
            let afterKeyframe = null;
            for (let i = 0; i < keyframes.length; i++) {
                if (keyframes[i].time <= currentTime) beforeKeyframe = keyframes[i];
                if (keyframes[i].time >= currentTime && !afterKeyframe) {
                    afterKeyframe = keyframes[i];
                    break;
                }
            }
            if (beforeKeyframe && afterKeyframe) {
                const t = (currentTime - beforeKeyframe.time) / (afterKeyframe.time - beforeKeyframe.time);
                Object.keys(liveState.tracks).forEach(track => {
                    const beforeValue = beforeKeyframe.tracks[track];
                    const afterValue = afterKeyframe.tracks[track];
                    const interpolatedValue = beforeValue + (afterValue - beforeValue) * t;
                    liveState.tracks[track] = Math.round(interpolatedValue);
                });
            } else if (beforeKeyframe) {
                liveState.tracks = { ...beforeKeyframe.tracks };
            }
            updateUI();
        }
        function updateUI() {
            Object.entries(liveState.tracks).forEach(([track, value]) => {
                const fader = document.querySelector(`[data-track="${track}"]`);
                if (fader) {
                    const knob = fader.querySelector('.fader-knob');
                    const valueDisplay = fader.parentElement.querySelector('.fader-value');
                    knob.style.top = value + '%';
                    valueDisplay.textContent = value + '%';
                    updateMeter(track, value);
                }
            });
        }
        function toggleGlitch() {
            liveState.chaos.glitch = !liveState.chaos.glitch;
            const button = document.querySelector('[onclick="toggleGlitch()"]');
            button.classList.toggle('active', liveState.chaos.glitch);
            generateCode();
        }
        function toggleGranular() {
            liveState.chaos.granular = !liveState.chaos.granular;
            const button = document.querySelector('[onclick="toggleGranular()"]');
            button.classList.toggle('active', liveState.chaos.granular);
            generateCode();
        }
        function toggleSpectral() {
            liveState.chaos.spectral = !liveState.chaos.spectral;
            const button = document.querySelector('[onclick="toggleSpectral()"]');
            button.classList.toggle('active', liveState.chaos.spectral);
            generateCode();
        }
        function toggleLFO() {
            liveState.chaos.lfo = !liveState.chaos.lfo;
            const button = document.querySelector('[onclick="toggleLFO()"]');
            button.classList.toggle('active', liveState.chaos.lfo);
            generateCode();
        }
        function showStatus(message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }
        async function generateCode() {
            const outputGrid = document.getElementById('outputGrid');
            outputGrid.innerHTML = '';
            const activeTracks = Object.entries(liveState.tracks)
                .filter(([track, level]) => level > 20 && !liveState.muted[track])
                .sort((a, b) => b[1] - a[1]);
            if (activeTracks.length === 0) {
                outputGrid.innerHTML = '<div class="code-preview"><div class="loading">üéõÔ∏è Turn up some faders to generate code!</div></div>';
                return;
            }
            for (const [track, level] of activeTracks) {
                const codePreview = document.createElement('div');
                codePreview.className = 'code-preview';
                codePreview.innerHTML = `
                    <div class="code-header">${getTrackIcon(track)} ${getTrackName(track)} (${level}%)</div>
                    <div class="loading">üîÑ Generating ${track} code...</div>
                `;
                outputGrid.appendChild(codePreview);
                try {
                    await new Promise(resolve => setTimeout(resolve, 150 + Math.random() * 200));
                    const code = generateDemoCode(track, level);
                    codePreview.innerHTML = `
                        <div class="code-header">${getTrackIcon(track)} ${getTrackName(track)} (${level}%)</div>
                        <pre>${code}</pre>
                    `;
                } catch (error) {
                    codePreview.innerHTML = `
                        <div class="code-header">${getTrackIcon(track)} ${getTrackName(track)} (${level}%)</div>
                        <div class="error">‚ùå Error generating ${track} code: ${error.message}</div>
                    `;
                }
            }
            showStatus('‚úÖ Code live performance ready!');
        }
        function generateDemoCode(track, level) {
            const parallel = level > 60;
            const unsafe = level > 85;
            const demos = {
                rust: `use rayon::prelude::*;
pub fn process_data() -> Vec<i32> {
    (0..100)
        ${parallel ? '.into_par_iter()' : '.iter()'}
        .filter(|&x| x % 2 == 0)
        .map(|x| x * x)
        .collect()
}`,
                julia: `function process_data()
    x = 0:99
    mask = x .% 2 .== 0
    ${parallel ? 'Threads.@threads' : ''} return (x .* x)[mask]
end`,
                sql: `WITH series AS (
    SELECT generate_series(0, 99) AS x
)
SELECT x * x AS result
FROM series
WHERE x % 2 = 0;`,
                ts: `export ${parallel ? 'async ' : ''}function processData(): ${parallel ? 'Promise<number[]>' : 'number[]'} {
    const data = Array.from({length: 100}, (_, i) => i);
    ${parallel ? `return new Promise((resolve) => {
        const worker = new Worker('processor.js');
        worker.postMessage(data);
        worker.onmessage = (e) => resolve(e.data);
    });` : `return data
        .filter(x => x % 2 === 0)
        .map(x => x * x);`}
}`
            };
            return demos[track] || `// Demo code for ${track}`;
        }
        function getTrackIcon(track) {
            const icons = { rust: 'ü¶Ä', julia: 'üî¨', sql: 'üóÑÔ∏è', ts: 'üì±' };
            return icons[track] || 'üéµ';
        }
        function getTrackName(track) {
            const names = { rust: 'Rust', julia: 'Julia', sql: 'üóÑÔ∏è', ts: 'TypeScript' };
            return names[track] || track;
        }
    </script>
</body>
</html>
