<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Polyglot Code Sampler - Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .input-section {
            background: linear-gradient(145deg, #2a2a3e, #1e1e2e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #4a4a5e;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .python-input {
            width: 100%;
            background: #0a0a0a;
            border: 1px solid #4a4a5e;
            border-radius: 8px;
            padding: 15px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 1rem;
            color: #e0e0e0;
            resize: vertical;
            min-height: 120px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-label {
            font-size: 0.9rem;
            color: #a0a0a0;
            font-weight: 600;
        }

        .control-select {
            background: #1a1a2e;
            border: 1px solid #4a4a5e;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e0e0e0;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .control-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: #4ecdc4;
        }

        .generate-button {
            background: linear-gradient(145deg, #4ecdc4, #45b7d1);
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            color: #1a1a2e;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 20px 0;
            width: 100%;
        }

        .generate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }

        .generate-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            background: linear-gradient(145deg, #2a2a3e, #1e1e2e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #4a4a5e;
        }

        .output-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: #1a1a2e;
            border: 1px solid #4a4a5e;
            border-radius: 8px;
            padding: 10px 20px;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .tab-button:hover {
            border-color: #4ecdc4;
            color: #4ecdc4;
        }

        .tab-button.active {
            background: linear-gradient(145deg, #4ecdc4, #45b7d1);
            border-color: #4ecdc4;
            color: #1a1a2e;
        }

        .code-output {
            background: #0a0a0a;
            border: 1px solid #4a4a5e;
            border-radius: 8px;
            padding: 20px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 0.9rem;
            color: #e0e0e0;
            white-space: pre-wrap;
            min-height: 300px;
            overflow-y: auto;
            position: relative;
        }

        .loading {
            color: #4ecdc4;
            font-style: italic;
            text-align: center;
            padding: 40px;
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }

        .examples {
            background: linear-gradient(145deg, #1e1e2e, #2a2a3e);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #3a3a4e;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: #0a0a0a;
            border: 1px solid #4a4a5e;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            border-color: #4ecdc4;
            transform: translateY(-2px);
        }

        .example-title {
            font-size: 1rem;
            color: #4ecdc4;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .example-code {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 0.85rem;
            color: #a0a0a0;
            white-space: pre-wrap;
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #4ecdc4, #45b7d1);
            color: #1a1a2e;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .status-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .playground {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .example-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="status-indicator" id="statusIndicator">üéÆ Playground Ready</div>

    <div class="container">
        <div class="header">
            <h1>üéÆ Polyglot Code Sampler Playground</h1>
            <p>Transform Python comprehensions into optimized code across multiple languages</p>
        </div>

        <!-- Examples Section -->
        <div class="examples">
            <h2 class="section-title">üí° Try These Examples</h2>
            <div class="example-grid">
                <div class="example-card" onclick="loadExample('math')">
                    <div class="example-title">üî¢ Mathematical Operations</div>
                    <div class="example-code">[x * x for x in range(100) if x % 2 == 0]</div>
                </div>
                <div class="example-card" onclick="loadExample('data')">
                    <div class="example-title">üìä Data Processing</div>
                    <div class="example-code">[user.name for user in users if user.active and user.score > 80]</div>
                </div>
                <div class="example-card" onclick="loadExample('nested')">
                    <div class="example-title">üîÑ Nested Comprehensions</div>
                    <div class="example-code">[x + y for x in range(10) for y in range(5) if x % 2 == 0]</div>
                </div>
                <div class="example-card" onclick="loadExample('dict')">
                    <div class="example-title">üìù Dictionary Comprehension</div>
                    <div class="example-code">{i: i*i for i in range(100) if i % 3 == 0}</div>
                </div>
                <div class="example-card" onclick="loadExample('sum')">
                    <div class="example-title">‚ûï Sum Reduction</div>
                    <div class="example-code">sum(i*i for i in range(1, 100) if i % 2 == 0)</div>
                </div>
                <div class="example-card" onclick="loadExample('complex')">
                    <div class="example-title">üßÆ Complex Operations</div>
                    <div class="example-code">[process_item(item) for item in items if item.category == 'important' and item.value > threshold]</div>
                </div>
            </div>
        </div>

        <!-- Main Playground -->
        <div class="playground">
            <!-- Input Section -->
            <div class="input-section">
                <h2 class="section-title">üêç Python Input</h2>
                <textarea class="python-input" id="pythonInput" placeholder="Enter your Python comprehension here...">[x * x for x in range(100) if x % 2 == 0]</textarea>

                <div class="controls">
                    <div class="control-group">
                        <label class="control-label">Target Language</label>
                        <select class="control-select" id="targetSelect">
                            <option value="rust">ü¶Ä Rust</option>
                            <option value="ts">üì± TypeScript</option>
                            <option value="go">‚ö° Go</option>
                            <option value="csharp">üíé C#</option>
                            <option value="julia">üî¨ Julia</option>
                            <option value="sql">üóÑÔ∏è SQL</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Mode</label>
                        <select class="control-select" id="modeSelect">
                            <option value="auto">Auto</option>
                            <option value="loops">Loops</option>
                            <option value="broadcast">Broadcast</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label class="control-label">SQL Dialect</label>
                        <select class="control-select" id="dialectSelect">
                            <option value="postgresql">PostgreSQL</option>
                            <option value="sqlite">SQLite</option>
                            <option value="duckdb">DuckDB</option>
                        </select>
                    </div>
                </div>

                <div class="control-checkbox">
                    <input type="checkbox" class="checkbox" id="parallelCheck" checked>
                    <label for="parallelCheck">Enable Parallel Processing</label>
                </div>

                <div class="control-checkbox">
                    <input type="checkbox" class="checkbox" id="unsafeCheck">
                    <label for="unsafeCheck">Enable Unsafe Optimizations</label>
                </div>

                <div class="control-checkbox">
                    <input type="checkbox" class="checkbox" id="explainCheck" checked>
                    <label for="explainCheck">Include Explanatory Comments</label>
                </div>

                <button class="generate-button" onclick="generateCode()">üéµ Generate Code</button>
            </div>

            <!-- Output Section -->
            <div class="output-section">
                <h2 class="section-title">üéß Generated Output</h2>

                <div class="output-tabs">
                    <button class="tab-button active" onclick="showTab('code')">Generated Code</button>
                    <button class="tab-button" onclick="showTab('ir')">Intermediate Representation</button>
                    <button class="tab-button" onclick="showTab('info')">Generation Info</button>
                </div>

                <div class="code-output" id="codeOutput">
                    <div class="loading">üéÆ Click "Generate Code" to see the magic happen!</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = "http://localhost:8787";
        const API_ENDPOINTS = {
            render: `${API_BASE}/v1/render`,
            health: `${API_BASE}/v1/health`
        };

        // State
        let currentOutput = {
            code: '',
            ir: '',
            info: {}
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await checkApiConnection();
            generateCode(); // Generate initial example
        });

        async function checkApiConnection() {
            try {
                const response = await fetch(API_ENDPOINTS.health, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    showStatus('‚úÖ API Connected');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showStatus('‚ùå API Offline - Demo Mode');
                // Fall back to demo mode
            }
        }

        function loadExample(type) {
            const examples = {
                math: '[x * x for x in range(100) if x % 2 == 0]',
                data: '[user.name for user in users if user.active and user.score > 80]',
                nested: '[x + y for x in range(10) for y in range(5) if x % 2 == 0]',
                dict: '{i: i*i for i in range(100) if i % 3 == 0}',
                sum: 'sum(i*i for i in range(1, 100) if i % 2 == 0)',
                complex: '[process_item(item) for item in items if item.category == "important" and item.value > threshold]'
            };

            document.getElementById('pythonInput').value = examples[type];
            generateCode();
        }

        async function generateCode() {
            const outputEl = document.getElementById('codeOutput');
            const generateButton = document.querySelector('.generate-button');

            generateButton.disabled = true;
            generateButton.textContent = 'üîÑ Generating...';
            showStatus('üéµ Generating code...');

            outputEl.innerHTML = '<div class="loading">üîÑ Generating code...</div>';

            try {
                const pythonCode = document.getElementById('pythonInput').value;
                const target = document.getElementById('targetSelect').value;
                const mode = document.getElementById('modeSelect').value;
                const dialect = document.getElementById('dialectSelect').value;
                const parallel = document.getElementById('parallelCheck').checked;
                const unsafe = document.getElementById('unsafeCheck').checked;
                const explain = document.getElementById('explainCheck').checked;

                // Call API
                const response = await fetch(API_ENDPOINTS.render, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: pythonCode,
                        target: target,
                        mode: mode,
                        dialect: target === 'sql' ? dialect : undefined,
                        parallel: parallel,
                        unsafe: unsafe,
                        explain: explain,
                        effects: {
                            predicate_pushdown: true,
                            constant_folding: true,
                            parallel_safety: true,
                            type_inference: false
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();

                // Store results
                currentOutput = {
                    code: result.code,
                    ir: JSON.stringify({
                        kind: 'comprehension',
                        expr: pythonCode,
                        target: target,
                        parallel: parallel,
                        mode: mode
                    }, null, 2),
                    info: {
                        target: result.target,
                        timing: result.timing,
                        meta: result.meta
                    }
                };

                // Show code by default
                showTab('code');
                showStatus('‚úÖ Code generated successfully!');

            } catch (error) {
                outputEl.innerHTML = `
                    <div class="error">
                        ‚ùå Error generating code: ${error.message}
                        <br><br>
                        <strong>Demo Mode:</strong> Here's what the generated code would look like:
                        <br><br>
                        <pre>${generateDemoCode()}</pre>
                    </div>
                `;
                showStatus('‚ö†Ô∏è Using demo mode');
            }

            generateButton.disabled = false;
            generateButton.textContent = 'üéµ Generate Code';
        }

        function generateDemoCode() {
            const target = document.getElementById('targetSelect').value;
            const parallel = document.getElementById('parallelCheck').checked;

            const demos = {
                rust: `use rayon::prelude::*;

pub fn process_data() -> Vec<i32> {
    (0..100)
        ${parallel ? '.into_par_iter()' : '.iter()'}
        .filter(|&x| x % 2 == 0)
        .map(|x| x * x)
        .collect()
}`,
                ts: `export ${parallel ? 'async ' : ''}function processData(): ${parallel ? 'Promise<number[]>' : 'number[]'} {
    const data = Array.from({length: 100}, (_, i) => i);
    ${parallel ? `return new Promise((resolve) => {
        const worker = new Worker('processor.js');
        worker.postMessage(data);
        worker.onmessage = (e) => resolve(e.data);
    });` : `return data
        .filter(x => x % 2 === 0)
        .map(x => x * x);`}
}`,
                go: `func processData() []int {
    result := make([]int, 0, 50)
    ${parallel ? `var wg sync.WaitGroup
    mu := sync.Mutex{}

    for i := 0; i < 100; i++ {
        wg.Add(1)
        go func(x int) {
            defer wg.Done()
            if x%2 == 0 {
                mu.Lock()
                result = append(result, x*x)
                mu.Unlock()
            }
        }(i)
    }
    wg.Wait()` : `for i := 0; i < 100; i++ {
        if i%2 == 0 {
            result = append(result, i*i)
        }
    }`}
    return result
}`,
                csharp: `using System.Linq;

public static class Program {
    public static ${parallel ? 'IEnumerable<int>' : 'List<int>'} ProcessData() {
        var data = Enumerable.Range(0, 100);
        ${parallel ? `return data.AsParallel()` : `return data`}
            .Where(x => x % 2 == 0)
            .Select(x => x * x)${parallel ? '' : '.ToList()'};
    }
}`,
                julia: `function process_data()
    x = 0:99
    mask = x .% 2 .== 0
    ${parallel ? 'Threads.@threads' : ''} return (x .* x)[mask]
end`,
                sql: `WITH series AS (
    SELECT generate_series(0, 99) AS x
)
SELECT x * x AS result
FROM series
WHERE x % 2 = 0;`
            };

            return demos[target] || '// Demo code would appear here';
        }

        function showTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show content
            const outputEl = document.getElementById('codeOutput');

            switch(tab) {
                case 'code':
                    outputEl.innerHTML = `<pre>${currentOutput.code || 'No code generated yet'}</pre>`;
                    break;
                case 'ir':
                    outputEl.innerHTML = `<pre>${currentOutput.ir || 'No IR available'}</pre>`;
                    break;
                case 'info':
                    const info = currentOutput.info;
                    outputEl.innerHTML = `
                        <div style="color: #4ecdc4; margin-bottom: 15px;">
                            <strong>Generation Information</strong>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Target:</strong> ${info.target || 'N/A'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Timing:</strong> ${info.timing ? `${info.timing.total_ms.toFixed(2)}ms` : 'N/A'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Output Length:</strong> ${info.meta ? info.meta.output_length : 'N/A'} characters
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Effects:</strong> ${info.meta ? Object.entries(info.meta.effects).filter(([_, v]) => v).length : 0} active
                        </div>
                    `;
                    break;
            }
        }

        function showStatus(message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
